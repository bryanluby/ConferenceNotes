# WWDC 2016

## Table of Contents

- [Keynote](#keynote)
- [Platforms State of the Union](#platforms-state-of-the-union)
- [Whats New in Foundation for Swift](#whats-new-in-foundation-for-swift)
- [Whats New in watchOS 3](#whats-new-in-watchos-3)
- [Visual Debugging with Xcode](#visual-debugging-with-xcode)
- [Introducing SiriKit](#introducing-sirikit)
- [Introducing Expanded Subscriptions in iTunes Connect](#introducing-expanded-subscriptions-in-itunes-connect)
- [Advances in UIKit Animations and Transitions](#advances-in-uikit-animations-and-transitions)
- [Whats New in Cocoa Touch](#whats-new-in-cocoa-touch)
- [Whats New in iTunes Connect](#whats-new-in-itunes-connect)
- [Introducing Apple File System](#introducing-apple-file-system)
- [Whats New in Cocoa](#whats-new-in-cocoa)
- [Whats New in tvOS](#whats-new-in-tvos)
- [Understanding Swift Performance](#understanding-swift-performance)
- [Improving Existing Apps with Modern Best Practices](#improving-existing-apps-with-modern-best-practices)
- [Whats New in Core Data](#whats-new-in-core-data)
- [Introducing Search Ads](#introducing-search-ads)
- [Go Live with ReplayKit](#go-live-with-replaykit)
- [iMessage Apps and Stickers Part 1](#imessage-apps-and-stickers-part-1)
- [iMessage Apps and Stickers Part 2](#imessage-apps-and-stickers-part-2)
- [Introduction to Notifications](#introduction-to-notifications)
- [Advanced Notifications](#advanced-notifications)
- [Unified Logging and Activity Tracing](#unified-logging-and-activity-tracing)
- [Extending the Xcode Source Editor](#extending-the-xcode-source-editor)
- [Increase Usage of your App with Proactive Suggestions](#increase-usage-of-your-app-with-proactive-suggestions)
- [Extending your App with Safari App Extensions](#extending-your-app-with-safari-app-extensions)
- [Whats New in HomeKit](#whats-new-in-homekit)
- [Leveraging Touch Input on iOS](#leveraging-touch-input-on-ios)
- [Speech Recognition API](#speech-recognition-api)
- [Going Server Side with Swift Open Source](#going-server-side-with-swift-open-source)
- [Whats New in Auto Layout](#whats-new-in-auto-layout)
- [Making Apps Adaptive Part 1](#making-apps-adaptive-part-1)
- [Whats New in Xcode App Signing](#whats-new-in-xcode-app-signing)

## Keynote

### watchOS 3

- Keep favorite apps in memory
- Fast launch times
- Background updating
- Dock for app switching. Use side button.
- Control center. Swipe up from bottom
- Scribble for message composition.
- SOS emergency calls.
- Breathe app. Deep breathing reminders.
- Apple Pay
- Background workout
- SpriteKit, SceneKit
- Access to crown events.
- Gyroscope access

### tvOS

- Enhanced iOS remote app
- Single sign-on for tv apps
- ReplayKit, PhotoKit, HomeKit
- 4 game controller support

### macOS

- macOS Sierra
- Continuity improvements
- Auto unlock with watch
- Universal clipboard across devices
- iCloud Drive Desktop sharing
- Apple Pay on the web
- Tabs for apps
- Picture in picture
- Siri on the Mac

### iOS

- iOS 10

#### 10 features

1. User experience
    - Raise to wake
    - Expanded 3D Touch
    - Expanded lock screen support
    - 3D Touch widget
2. Siri
    - Siri API!
3. QuickType
    - Siri intelligence
    - Intelligent suggestions
4. Photos
    - Places - view all photos on map.
    - Advanced computer vision. Facial recognition.
    - Object and scene recognition.
    - Memories - Trips, Dates, People, Topics
5. Maps
    - New design
    - Suggestions
    - Improved search
    - Map extensions api
6. Music
    - New Apple Music design
7. News
    - Subscriptions
    - Breaking notifications
8. HomeKit
    - New device types
    - Home builders building homes with HomeKit
    - Home app - Central place to control accessories
    - Siri integration
    - Control center integration
    - Lock screen integration
    - Remote access
9. Phone
    - Voicemail transcription
    - Call Id extension api
    - VoIP api
10. Messages
    - Rich links
    - Improved camera and photos
    - Bigger emoji!!!
    - Emoji predictions
    - Tap to replace with emojis
    - Bubble effects
    - Tapback
    - Handwritten messages
    - Digital touch
    - Full screen effects
    - iMessage Apps drawer
    - iMessage App Store
11. Misc
    - Notes collaboration
    - Live Photos editing
    - Split view on safari for iPad

### Privacy

- End to encryption
- On device intelligence
- Differential privacy

### Developers

- Swift Playgrounds for iPad - A new way to learn to code with Swift on iPad

## Platforms State of the Union

### iMessage Apps

- iMessage App Store

### SiriKit

- Speech - Intent - Action- Response
- You provide: vocabulary, app logic - user interface
- App vocabulary: plist, User vocabulary: code
- domain, intent, recipient, content
- Powered by extensions and NSUserActivity

### Swift

- Cleaner syntax in Swift 3 - GCD and CoreGraphics syntax
- Swift playgrounds app for iPad
    - Designed for touch
    - Dedicated coding keyboard
    - Lesson templates
    - File Format Documentation to create your own templates
    - Share documents - ReplayKit integration
    - Move between Xcode on mac
- Xcode
    - Source Editor
        - Active line highlight
        - Swift color literals
        - Swift image literals
        - Documentation generation
        - App extensions
            - Can distribute through App Store and Developer ID
            - Source Editing
    - API Reference improvements
    - Interface Builder
        - Show visual effects on the canvas
        - Device size/ orientation config bar
        - Canvas operations at any zoom level
        - Accessibility and Scriptibility
        - Development Issues - 135 new diagnostics - 3 new static analyzers
    - Captured crash logs that occur during testing
    - Test without building
    - Runtime issues
        - UI - Detect layout issues at runtime
        - Threads - Thread sanitizer - Detect common threading problems
        - Memory - Memory debugger - Visualize object graph for running app - Automatically finds leaks
    - Provisioning
        - New signing actions
        - Provisioning log
        - Automatic code signing, Customized code signing
        - Multiple dev certs
    - Performance improvements

- Platforms
    - Compression
    - Networking - network priority for apps
    - Improved logging - Re-written console app
    - Apple File System
        - Fast
        - Designed for newer storage tech
        - Cloning - fast cloning
        - Snapshots - backup use cases - multi-user use cases
    - Privacy
        - Differential privacy
        - Privacy budget

- iOS 10 Higher Level Features
    - Share button quick action
    - Map extensions
    - Integrating with iOS
    - Service Extension - Modify push payload before show it to user - Decrypt encrypted data on device - end to end encryptieon
    - Content Extension - Improved, customized UI for notifications
    - Widget from app quick action
- macOS
    - Right-to-left support
    - Window Tabs - Works out of the box with NSDocument based appeds
    - iCloud documents on the desktop
    - iCloud no longer required to have Mac App Store app
    - CloudKit
        - CloudKit Sharing - Explicit control over who can access your data - CKShare
- watchOS
    - Glanceable
    - Actionable
    - Responsive
    - Background App Refresh
    - Background runtime
    - Continuous sensor access
    - Crown event
    - Gesture Recognizers
    - Gyroscope!
    - Watchface gallery
- tvOS
    - Dark Appearance
    - Integrate with other Apple devices
    - Multipeer Connectivity now available
    - Support four simultaneous controllers
    - Updated controller policy. Games can now require a game controller.
- Graphics Technologies
    - Color
        - Wide Color (P3)
        - Supported through system apis
        - Automatic UIView and UIImageView support
    - Metal
        - Games
            - ReplayKit Streaming
            - Game Center - Invite anyone you can send a message to.
            - Game Center Sessions - Sessions where users can come and go.

## Whats New in Foundation for Swift

- Design Guidelines
    - Consistent Experience
    - Apply API design guideline to standard lib
    - Better tranlation of Objc apis into Swift
- Foundation
    - Leverage point - small changes can have a big impact on the entire SDK
    - Mutability and Foundation value types
    - Dnop NS prefix
- Value Types
    - Neither is better just used in different ways
    - Object identity vs stored contents
    - Copy on write - isUniquelyReferenced
    - Lots of new value types
        - NSDateFormatter nested types
        - Strongly typed string enumerations
        - Class properties in ObjC
    - Date
    - Measurement
    - URL Components
    - URL Resource Values struct
- Adoption
    - Swift 3 migrator

## Whats New in watchOS 3

- Glanceable
- Actionable
- Responsive
- Background App Refresh
    - Favorite apps kept in memory
    - Update complication
        - Silent complication push updates - Can also be triggered from iPhone app
        - Scheduled updates - Target once per hour but it could happen more frequently
    - Update app
    - Update snapshot - Apps that are in the dock
- Simplifying navigation
    - WatchKit table vertical paging mode for going into detail views (similar to Weather, Stocks)
- Expanded api availability
    - Schedule local notifications on the watch itself
    - Continuous sensor access
    - Background runtime
    - Crown events
    - Gesture recognizers
    - SpriteKit and SceneKit - Can be used in long look notificatioins
    - Inline video
    - GameKit
    - Speaker access
    - CloudKit
    - Apple Pay
- Discoverability and configuration

## Visual Debugging with Xcode

- Runtime issues
	- Threading - Detect issues at runtime
		- Thread sanitizer - races, leaks.
	- UI
		- Faster snapshots
		- Layout accuracy improvements
		- Jump to class
		- Navigator filtering - Filter by class names, memory address
		- Improved auto layout debugging
		- Automatically detect ambiguous layout . Show badges in navigator.
	- Memory
- View debugging
- State machine Quick Looks
	- Visualize GKStateMachine with Quick Look
- SpriteKit/SceneKit FPS gauge
	- Timeline history of CPU frame time
- Memory graph debugging
	- "Why does this object exist?"
	- View object memory graph
	- Root paths graph style
	- Cycles graph style
	- Check "Malloc Stack" in Diagnostics - Select "Live Allocations Only" for lower overhead
	- .memgraph file format for saving and sharing
	- Command line functionality
	- Graph is conservative - there may be extraneous references - Enabling Malloc Scribble may improve accuracy
	- Gray references are unknown
	- Bold references are known to be strong
	- Validate your expectations
		- Are there more objects than you expect?
		- Are they being deallocated when no longer necessary?

## Introducing SiriKit

- Intents
- IntentResponse
- Resolve
- Adding SiriKit to your app
	- Intents extension
		- Basis of SiriKit
		- Supports one or more intents
		- Runs in the background while Siri is active
		- Handles intent lifecycle
	- Intents UI extension
		- Bring your apps interface to Siri
		- Provide a UIView Controller
		- Optional - Can use default interface
	- App vocabulary
		- Words or phrases that are part of your app
		- Known to all users of your app
		- Defined in a plist in main bundle. Localizable.
			- Example Uses for App
			- Parameters - Phrase, pronunciation, example
	- User vocabulary
		- Unique to individual users of your app
		- Provided by your app at runtime
		- Ordered set of terms. Ordered by priority to your users.
		- Contacts, workout names, photo albums, photo keywords
		- Only provide necessary values
		- Clear vocabulary if user logs out
	- Need permission to use Siri. Explain to the user what data goes to Siri.
- Siri is an integral part of iOS
- Get the maps extension for free when adopting SiriKit
- Users are required to say the name of the app when requesting Siri. Bundle display name. Can be used in many parts of speech. Users can use your app name as a verb.
- Design Topics
	- How Siri helps you
	- Design guidelines
		- Prepare - Ask real users what they would ask Siri
		- Be a good listener - Use the original request - Pick good defaults
		- Ask Questions - Keep it simple - Only ask for things that are necessary
		- Confirmation - Check with your users
		- Disambiguation - presenting multiple options
		- Final Confirmation
	- Polish the design
		- Guide examples
			- Include your app name
			- Keep your examples short
			- Provide multiple examples for each intent
			- Localize examples

## Introducing Expanded Subscriptions in iTunes Connect

- Auto-Renewable Subscription Change. 85% proceeds for one year or more. Current customers count towards this.
- No more category limitations.
- Subscription group: collection of subscriptions that describe your app offering. One active subscription per group.
- Switching within groups will not effect 85% proceeds.
- Upgrade goes into effect immediately.
- Downgrade goes into effect at the end of the current subscription period.
- Subscription levels: ex. platinum, gold, silver
- Territory Pricing. Set different prices for different territories. Base currency and base price.
- Price increases. Customer will receive a push notification and an enhanced email to accept/reject.
- Can preserve price for existing customers while increasing for new ones.

## Advances in UIKit Animations and Transitions

- UIViewPropertyAnimator: Interruptible, scrubbable, reversible, lots of timing functions, running animations can be modified
- Powerful when combined with view controller transitions
- UIViewAnimating protocol
- Observable properties: state, isRunning, isReversed
- Reversing: pause and reverse, reverse on the fly, animate back
- UICubicTimingParameter: Use UICubicTimingParameter() for the default UIKit timing curve
- UISpringTimingParameters: UISpringTimingParameters() used by Apple for standard push/pop onto a nav controller
- Hit testing moving views - isManualHitTestingEnabled = false
- Interruptible keyframe animations - Add UIView animateKeyframes as a closure to UIViewPropertyAnimator addAnimations
- interactivePopGestureRecognizer - can use this along with your own custom interaction

## Whats New in Cocoa Touch

- Core Technologies
    - Swift improved API design guidelines
    - GCD
        - GCD can automatically wrap each work item in an autoreleasepool `autoreleaseWorkItem`
    - Foundation
        - Swift improvements
        - Value types
        - Units and measurements
        - 8601 date formatter
        - NSDateInterval
    - UIPasteboard universal clipboard support.
        - A paste item may have to retrieve remote data. Check for pasteboard content without fetching. Can check for strings, urls, images, colors
        - Control what you publish: restrict pasting or set an expiration date
    - Color
        - Wide Color. You can now represent colors on screen that was not possible before.
        - From sRGB to extended sRGB
        - Wide color APIs are exposed in iOS 10
        - UIImageView has been color-managed since iOS 9.3
        - UIColor support - built in with initializers
    - Image Rendering with UIGraphicsRenderer
        - Fully color managed by default
        - Block-based API
        - Concrete subclasses for images and PDFs
        - Manages context lifetime
    - Asset Management
        - Wide color assets
        - Directional image assets - left-to-right or right-to-left
        - Compression - supports automatic lossy compression
- Building better UIs
    - New Accessibility Inspector. Can run accessibility audit
    - Speech Recognition with SFSpeechRecognizer
        - Connect it to audio files or buffers
        - Optimized for free-form dictation or search-style strings
    - Smarter Text Input
        - Semantic tagging of text fields, views and web content. This will provide intelligent quick type suggestions
        - Many predefined content types: people, locations, email, telephone, credit card numbers, etc.
        - Dynamic Type content size category trait
            - No longer a property on UIApplication
            - No need to listen to notifications
            - Available in all UI extensions
            - Automatic update support in label, text views, and controls with new adjustsFontForContentSizeCategory
    - Improved Customizations
        - Tab bar items badge colors, text attributes, unselected tint color
    - Peek & Pop
        - Available for WKWebView
        - New UIPreviewInteraction to have your own animation for peek and pop
    - Refresh Control
        - Full support for UIScrollview and subclasses
    - Collection View
        - Simplified self sizing cells in flow layout
        - Paging support in collection view reordering
        - Automatic smooth scrolling improvements with cell prefetching. If you build your app for iOS 10 you get this for free.
        - Data prefetching - ex. Prefetch network data  (also available on UITableView)
    - UIViewPropertyAnimator
        - Interruptible
        - Scrubbable
        - Reversible
        - More timing curves
        - Dynamic
        - Similar to a timeline in iMovie
        - Fully integrated in view controller transition system
- Adopting system features
    - Improving openURL
        - Asynchronous with completion
        - Check if handler app is installed for universal links
    - Core Data
        - Query generations - control when moving to a new version of data
        - Concurrency improvements
        - Tooling improvements
    - CloudKit
        - Record sharing - multiple users accessing the same record
            - UICloudSharingController - Manages the invitation flow for collaboration
    - NSUserActivity
        - Adding support for locations in a user activity
        - Proactively suggestions
    - App Search
        - CoreSpotlight Continuation - Users can continue their spotlight search back in your app
        - CoreSpotlight Search API
            - Search what you have already indexed
            - High performance
            - Query syntax
    - ReplayKit
        - Live broadcasting
        - Third-party services support with extensions
    - SceneKit
        - New improved realistic rendering engine
    - Apple Pay
        - Apple Pay in Safari
        - Can be used in Safari View Controller
        - Can be used in non-UI extensions - ex. In an iMessage app
- Integrating with iOS
    - Keyboard extension
        - Automatically switch multi-language keyboard based on text
        - System globe key in your extension
    - Widgets
        - Now have display modes
            - User controlled
            - Compact is fixed height
            - Expanded is variable height
            - This will appear on the lock screen. Don't surprise your users.
    - User Notifications
        - Unifies local and remote notifications!
        - Better delivery management
        - In-app presentation option
        - Multi-platform
        - Service extension - process the payload before it appears on screen
        - Media attachments
        - End-to-end encryption - decrypt something upon receiving it
        - UI extension point
            - Can have embedded UIViews
            - Can't directly interact with the view but you can have notification actions
    - CallKit
        - Directory extension
            - Configure how you can block incoming calls
            - Configure how numbers are identified to the user
        - Call Provider API
            - VoIP apps
            - Full screen incoming call UI
            - Integrated with other types of calls
            - VoIP calls appear in in favorites and recents
            - Supports Siri, CarPlay, Do Not Disturb, Bluetooth
    - SiriKit
        - Intents Extension
        - IntentsUI Extension - custom UI
    - iMessage Apps
        - Sticker Packs
        - Messages Extension
            - Interactive messages

## Whats New in iTunes Connect

- In-App purchase promo codes
- iTunes Connect for iOS
    - Sales and Trends data
    - Ratings and reviews
    - Reject binaries
    - Release app to the app store
    - New push notifications
        - Contracts expiring
        - App review messages
        - App finished processing
    - New Multi Provider support
        - One account with multiple dev teams
    - New Full access to the resolution center
- App Analytics
    - Impressions
        - Number of times a customer has viewed your app on the App Store
            - Also applies to search, featured, category views
        - Can use comparison features to calculate conversion rates. Ex. Impressions / App Units
    - Sources (How are users finding my app?) - Coming later this year
        - App Store
        - Websites
        - Other Apps
- Screenshot Simplification
    - Can now choose to use one set of screenshots per device family!
    - Media manager for customizing different sizes and localizations
    - Create only required screenshots that can enable sharing across devices and locales
- iMessage Apps
    - New Stickers category and subcategories
    - Device screenshots templates
- Guideline Changes
    - App review times have gone way down
    - More human readable
    - Combined with macOS guidelines
    - Organized contextually
        - Safety
        - Performance
        - Business
        - Design
        - Legal

## Introducing Apple File System

- Available as a developer preview
- Improved file system fundamentals
    - SSD-optimized
    - Crash-protected
    - 64-bit native fields
    - Potential for data structure growth
    - Optimized for Apple
    - Low-latency
    - Native encryption support built-in
- HFS Compatible
- Space Sharing
    - Partitions can adjust size on demand
- Cloning Files and Directories
    - Uses references where possible for performance
- Snapshots and reversions
    - Great for backups
- Fast Directory Sizing
- Atomic safe save primitives
- New APIs
    - NSFileManager copyItem, replaceItem work out of the box
    - libcopyfile - supports cloning
- In-place upgrade from HFS+ to APFS
- Shipping in 2017 - Will be the default file system for all Apple products

## Whats New in Cocoa

- API Updates
    - Swift API Guidelines
- App Kit
    - Window Snapping
    - Window Tabbing
        - Every window is visible
        - Hidden at the system level
        - Automatic
        - Create tab: orderFront()
        - Remove tab: orderOut()
        - Fully automatic for NSDocument-based app
        - Non-NSDocument based app - enable the "New tab" button - implement newWindowForTab
    - Right-to-Left Support
    - File Promise Drags
    - Container Views
        - NSCollectionView
            - Background view can scroll with content
            - Optional floating headers/footers
            - Can collapse a section into horizontal row
        - NSGridView
            - Auto layout container view
            - Intersecting rows and columns
            - Alignment
            - Spacing and padding
            - Cell merging similar to spreadsheets
            - Dynamic hiding of rows/columns
    - Deep Color API
    - Status Item Enhancements
        - Reordering and keyboard navigation
        - Command-click and drag to reorder
        - Hiding and removal
        - Autosave
    - Control Constructors
        - Convenience constructors on NSControls
        - Similar to Interface Builder object library
    - Weak delegates
    - Designated initializer declarations

## Whats New in tvOS

- 64 bit only
- Always connected to high speed data
- Auto download - Apps downloaded on iOS will be automatically downloaded to Apple TV
- HomeKit
- PhotoKit
- Focus Engine improvements to SpriteKit
- Can require game controller
- ReplayKit - broadcast live on services like mobcrush
- UserNotification framework
- ExternalAccessory framework for bluetooth accessories
- Notifications
    - Badge app icon
    - Remote notifications
        - Badge
        - Content-available
        - User notification framework only
- Appearance
    - Light / Dark
    - Dark appearance is opt-in. Light is default
    - Light and dark preview to storyboards
    - Simulator shortcut to toggle between appearances
    - Standard views and controls should work out of the box
    - Trait collection support
    - regular and prominent blur styles

## Understanding Swift Performance

- Stack or heap
    - Can use structs as keys - String contents are heap allocated
- Less or more reference counting
    - High reference counting overhead with structs that include reference types
    - Use enums with raw values
- Dynamic or static dispatch
    - Use Final class to not use static dispatch
- Choose fitting abstraction with the least dynamic runtime type requirements

## Improving Existing Apps with Modern Best Practices

- Reduce Technical Debt
    - Pick current release version and go 1 point back for supporting old versions.
    - Swift support for treating warnings as errors
    - Improve accessibility support
    - Use local-aware apis
    - Use 3D touch
    - Run the Swift migrator
    - File bug reports
- Asset Catalogs
    - Can use multiple catalogs
    - Can use migrator to migrate non-catalog image assets
    - Multiple compression settings in Xcode 8
    - Use asset slicing for rounded corner buttons
- Dependency Injection
    - Inject model objects into view controllers in prepareForSegue
- Live Playgrounds
    - Showed demo of a tableview in a live view
- Bring your model layer to other Apple platforms with platform-specific UI

## Whats New in Core Data

- Query Generations
    - All reads from a context see a single generation of data
    - Transactions are at context level
    - Work is isolated between peer contexts
    - Minimizes prefetching
    - `NSQueryGenerationToken`
- Concurrency
    - Connection pool
    - SQL store can now handle multiple concurrent requests: multiples readers and a single writer
        - More responsive UI
        - Simplify app architecture with less need for multiple stacks
- Core Data Stack Configuration
    - `NSPersistentStoreDescription` - Automatic lightweight migration and automatic mapping model inference turned on by default
    - Add store asynchronously
    - `NSPersistentContainer` encapsulates model, coordinator, and context
        - Main queue context property and private queue factory method
        - Method for performing background tasks `container.performBackgroundTask...`
    - New property for automatically merging changes from parent
- New API
    - `NSFetchRequestResult` protocol: managed objects, managed object ids, dictionaries, NSNumbers
    - `NSFetchedResultsController` now available on macOS
    - New convenience API for entity description, fetch requests, and creating a managed object
- Xcode Integration
    - Automatic Subclass Generation and regeneration

## Introducing Search Ads

- 65% of downloads come from App Store search
- App Store metadata (title, keywords, description) is very important for relevant search results
- Cost per Tap
- Second Price Auction - The price you pay is what your nearest competitor is willing to pay up to your maximum bid.
- Your add will be shown based on a combination of your app's relevance to the query and the competitiveness of your bid.
- Budget can have max daily spend and max cost per tap
- New keyword suggestions feature and popularity index
- Broad match and exact match keywords
- Can apply bids globally or by keyword
- User Targeting
    - By default the ad will not be shown to users who have already downloaded the app
    - Can also target new users, existing users, and users of your other apps
    - Can target gender, age group, device location
- Attribution API - Implemented at app level

## Go Live with ReplayKit

- ReplayKit Current Features
    - Record app visuals and audio
    - Record speech through mic (Except on Apple TV)
    - Share with system share sheet
    - Simple API
    - HD Quality
    - Privacy Features
- New Features
    - Apple TV Support
    - Live broadcasting to 3rd party services
        - Content is secure and only accessible to the broadcast service
        - Can use FaceTime camera and mic for commentary (iOS only)
        - Set up a broadcast
            - Broadcast UI Extension
                - Sign in / sign up
                - Accept terms
                - Share to social media that broadcast is about to begin
                - Notify ReplayKit setup is complete
        - Process and upload video and audio data
            - Broadcast Upload Extension
                - Receive  and process video and audio data
                - Upload to server
                - Implementation to be defined by broadcast services
                - Work together with Us (They recommend getting in touch with Apple for advice)
    - Expanded commentary options

## iMessage Apps and Stickers Part 1

- Three types of apps
    - Interactive messages
    - Stickers
    - Other Content - photos, videos, text, links, etc
- Many full iOS API are available: ex In app purchase, apple pay, camera
- Runs on iOS 10. Content can be received on watchOS and macOS. Can send recent stickers from watchOS.
- Inline app attribution - link back to the app that sent it
- Messages Framework
    - Built on top of app extensions
    - Not required to have a containing iOS app. Can ship a stand alone iMessage app.
        - The advantage of having a containing app are that the main app will be on the users home screen and the extension will show up in the iMessage app drawer. For the App Store, the main app will show up in the main App Store and the extension will show up in the iMessage App Store.
- Stickers
    - Images - animated or static
    - Great for sharing any content from your app
    - Apple predicts stickers are going to be extremely popular with iMessage users
    - Can create animated sticker using a sequence of pngs (Sticker Sequence)
    - Only need to provide assets @ 3x
    - Can adjust sticker cell size (@ 3x)
        - Small 100 x 100
        - Medium 136 x 136
        - Large 206 x 206
    - Supported formats
        - png, apng, jpeg, gif (Apple recommends sticking with png and apng)
        - Max file size is 500KB
    - Custom Sticker Apps
        - Customize the display of the UI (positioning, background color, etc)
        - Dynamically create stickers in the app - Can pull assets from your own server also
        - Can use the camera
        - In App Purchase (ex add purchases for more Stickers)
        - `MSStickerBrowserViewController`
        - Your app can also add Sticker support using `MSStickerView` and `MSSticker` - ex use collection view for grid
        - App can go from Compact to Expanded

## iMessage Apps and Stickers Part 2

- Interactive Messages
    - Compose an interactive message and insert into input field
    - Can reply to interactive message
- Message Layout
    - `MSMessageTemplateLayout`
    - Image - 300 x 300 recommended
    - Media file url - png, jpeg, gif, video (any video playable by media player framework)
    - May be transcoded on send
    - Avoid rendering text into images
    - Image title / subtitle
    - Caption / Trailing caption
    - Sub Caption / Trailing sub caption
    - App icon
- Cannot programmatically send a message - It must be user initiated
- Compact and expanded presentation styles - Can request a presentation style
- Use `summaryText` to collapse message changes in the conversation history
- Override methods
    - Did start sending - user has hit the send button
    - Did cancel sending
    - Did receive message
- Group conversations in iMessage
    - Only the tapped message is available to your iMessage app
    - Store state in the cloud using a session token
- Identifying a Sender
    - Contact info is not exposed to iMessage apps - have participant identifiers
    - Messages have a sender identifier
    - Can get number of participants
    - Can prefix the id with $ sign in some user facing views
    - Ids are unique to the device
    - Ids are scoped to the install of the iMessage app

## Introduction to Notifications

- User Notifications Framework
    - Familiar api with feature parity
    - Expanded content
    - Same code path for local and remote
    - Simplified delegate methods
    - Better notification management
    - In-app presentation
    - Schedule and handle in extensions
    - Local notifications on the watch - Does not have to be connected to iPhone
    - tvOS badge app icon
- Notification delivery
    - Access to user-defined settings
    - Title, subtitle, body
    - Media attachments
- Triggers
    - Push
    - Time Interval
    - Calendar
    - Location
- Notification Management
    - Access pending notifications
    - Access delivered notifications
    - Remove, update, and promote
- Notification Actions
    - Default - opens app
    - Custom
    - Dismiss - know when user dismisses a specific notification
- Service Extension
    - Augment or replace content before they are displayed to user
    - Short execution time
    - End to end encryption use case
    - Add attachments use case
    - need `mutable-content` key in payload

## Advanced Notifications

- Press for expanded UI
- Media attachments
    - Use service extension
    - Add url to payload - download url then present
    - Local and remote
    - Short execution time
- Custom UI
    - Notification content extension point
    - No interaction with views - Use notification actions instead
    - Can have multiple UIs depending on category of notification
    - Extract attachment from incoming notification and display it
    - Update UI from action responses
    - Can use custom input accessory views for text entry notifications

## Unified Logging and Activity Tracing

- One common logging system for both user and kernel mode
- Better log categorization
- Collects caller information for you
- New console app and command-line tool
- .tracev3 binary file format - /var/db/diagnostics/
- .logarchive file format for portability
- Can associate with subsystem or category
- Prevents accidental logging of private info
    - Dynamic strings, collections, and objects are assumed to be private
- Console
    - Can mute subsystems in contextual menu
    - Search tokens from contextual menu
    - Native sharing panel
- Built-in decoding of common values
- Activities are now objects that can be stored and reused
- Log command line tool has same functionality as Console
- Avoid wrapping `os_log` calls into other functions - you will lose line number and file info
- Use `os_log` for critical details
- `os_log_info` for additional info captured
- `os_log_debug` for high volume debugging during dev
- `os_log_error` to cause additional info to be captured from app
- `os_log_fault` to cause additional info to be captured from system
- Can use keyboard shortcuts for `sysdiagnose`

## Extending the Xcode Source Editor

- New SFMono font
- Selected line highlighting
- Option + Command + / insert documentation comment
- Image and color literals!
- Find pasteboard
- Source Editor Extensions
    - Edit text
    - Change selections
    - Can also have one extension with multiple commands
    - Run in separate process
    - Sandboxed
    - Get access to text at invocation
    - Embedded in a containing application
    - `extensionDidFinishLaunching`
    - Command list in info plist
    - Gets a separate submenu in editor menu
    - Performance
        - Start up quickly
        - Use GCD
        - Don't replace the whole buffer if you don't have to
        - Handle cancellation quickly

## Increase Usage of your App with Proactive Suggestions

- Handoff
- Contextual Siri Reminders
- QuickType
    - Configure `textContentType`
- Multitasking
- Contact Interactions
- The OS needs to know more about your data or app
- Deeper Siri integration for free
- NSUserActivity (native) and schema.org (web)
    - Capturing app state
    - Eligible for handoff, search, public indexing
- Location suggestions
    - Capture locations viewed by the user
    - Map item property on `NSUserActivity`
    - Works with app search api
- Media App Suggestions
    - Handle `MPPlayableContentManager` methods
- Best Practices
    - Use `needsSave` for lazy payload updates rather than updating the userInfo dictionary at every single step
    - Keep strong reference to the current activity or use built in view controller property
    - Transfer a small payload in the userInfo dictionary
    - Use reverse dns for your activity types
- schema.org
    - Some of the benefits of NSUserActivity for the web
    - Safari location suggestions
    - Postal address, geocoordinates, telephone
- Can register as a routing app.
- "The more the system knows about your app, the more opportunity it will have to promote it."
- Apple stresses they are continuing to make strong investments in this area. Hint hint?

## Extending your App with Safari App Extensions

- Customize web pages.
- Add toolbar buttons to Safari UI.
    - Display popovers with custom views.
- Add items to context menus on web pages.
- Sold through the Mac App Store or distribute with Developer ID
- The extension version is locked to the same version as your main app.
- Content Blockers
    - Can bring existing iOS content blockers to macOS. The APIs are the same.
- Page modification and communication with native code
    - Inject CSS style sheet
    - Inject Javascript content script. Injected before the DOM has been loaded.
- Extending Safari UI
    - Popovers
        - Can insert any `NSView` inside a toolbar popover
        - Share data with containing app
    - Contextual Menu Items
        - Useful for acting on selections
- Website Access Levels: All, Allowed Domains
- In the Develop menu turn on "Allow Unsigned Extensions" for easy testing of extensions.

## Whats New in HomeKit

- Overview
    - Home Database - All apps have access to this
    - Home Sharing - Allow family and friends to control things
    - Common protocol for accessories to communicate with an Apple device
    - Works with Siri
    - Accessory Communication
    - Apple TV can act as a remote access gateway
    - End to end encryption
    - Growing HomeKit accessory market
- What's New
    - Platforms
        - Home App
        - Control from iOS control center
        - Remote access and automation - works through Apple TV and iPad
            - Event and time triggers
            - Access control for shared users
            - Per user remote access
            - Multiple remote access devices can work together and extend through the home
        - Expanding HomeKit framework to tvOS
            - View configurations
            - Control accessories
            - Execute scenes
            - Siri - Ex. set thermostat to 73 from Siri remote
    - New accessories
        - Air Treatment
            - Air conditioners/heaters
            - Air purifiers
            - Humidifiers
        - Camera
            - Display live streams from camera
            - Display still images
            - Control the speaker and mic
        - Doorbell
            - Generates an event when pressed
            - Volume control
            - Visual indicator control
            - Also being integrated with other accessories like Camera. Ex. doorbell camera.
        - Service association
            - Doorbell camera take a picture when pressed and send a rich notification to the iPhone or Apple Watch
    - Frameworks Updates
        - Primary Service - Ex a fan with a light. The fan is the primary service.
        - Linked Services - Ex. three outlets and a switch
        - Valid Values - Can mark certain values as not valid for specific configurations
        - Setup of accessories - Simple way to find nearby accessories and add to home
        - Camera accessories apis
            - `HMCameraProfile` - control different aspects of the camera 

## Leveraging Touch Input on iOS

- Building a Drawing App
    - See SpeedSketch sample code
    - New API
    - Where to capture strokes in order of priority
        - UIGestureRecognizer
        - UIView
        - The responder chain
    - Use coalesced touches whenever possible
    - Do not draw on every touch event
        - Display refresh rate is 60Hz
        - Incoming event frequency can reach 240Hz and more. Be prepared to receive more events than the display refresh rate.
        - Do not try to draw faster than the screen can refresh. This will add lag and you will be doing work that doesn't get displayed on the screen.
    - When to render?
        - UIView: use `setNeedsDisplay` and move the drawing code into `drawRect`
        - Even better, mark only the changed areas with `setNeedsDisplayInRect`.
        - Activate `drawsAsynchronously` on the view's layer
    - Use predictive touch to improve perceived latency. Add them to your data structure temporarily. Choose their appearance depending on app.
- Apple Pencil
    - Get high precision by using `preciseLocationInView`
    - `touchesMoved` gets called more often with Force.
    - Use tilt and orientation
    - Force is measured along the axis of the pencil. perpendicular force. 
        - Force is measured inside the pencil and transmitted over the air to the iPad
    - Use estimated and estimated properties expecting updates
    - Disable scrolling when using Apple Pencil with allowed touch types on a gesture recognizer
    - Use `requiresExclusiveTouchType` property for uniqueness between touch and Apple Pencil

## Speech Recognition API

- iOS keyboard dictation limitations
    - Requires keyboard
    - Live audio only
    - Can't tell availability
    - Can't customize recording
- Speech api
    - Same tech as Siri
    - Fast and accurate
    - Requires iOS 10
    - Support for 50 languages and dialects
    - Usually requires internet connection - some devices and languages can do it offline
    - Always requires permission from the OS - A good thing to do would be to wait until recognition is used to request it.
    - Provide usage description in Info.plist
- Best Practices
    - Free but not unlimited
    - Per devices, per day limits
    - Per app limits
    - Prepare to handle failures
    - Speech recognition isn't cheap - requires power and data
    - Maximum utterance duration is about one minute for iOS 10
    - Show something in UI that recording is happening
    - Don't use for passwords or other sensitive speech
    - Show recognition results to the user before acting on them. Help them deal with recognition errors.

## Going Server side with Swift Open Source

- Why server-side Swift
    - Same code runs in both places
    - Reduce dev and testing time by sharing code
    - Leverage great APIs on the server 
    - Check out BluePic sample code from IBM
    - IBM Cloud Tools for Swift (Mac App)
- Architecture
    - Linux and Mac platform support
    - Standard Library
    - Foundation, Dispatch, XCTest
    - Compiler Command Line Tools

## Whats New in Auto Layout

- Incrementally adopt Auto Layout
- Can specify autoresizing masks for simple behavior. They will translate into constraints at runtime
- Can mix and match springs and struts with constraints
- Can turn off ambiguity per view
- NSGridView
    - Place content in explicit grid
- Layout Feedback Loop debugging
    - Upstream setNeedsLayout
    - UIViewLayouFeedbackLoopDebuggingThreshold 100 launch argument. Will throw log when hitting 100 for layoutSubviews
    - `po [_UIViewLayoutFeedbackLoopDebugguer layoutFeedbackLoopdebugger]`

## Making Apps Adaptive Part 1

- Takeaway: The system is going to do *most* of the work so you don't have to.
    -  300+ different UI combinations to deal with (Dynamic Type, Layout Direction, Display Gamut, Interface Style, etc)
- What traits are
    - environment that your app is running in
    - Layout traits: size classes, dynamic type, layout direction
    - Appearance: display gamut, light/dark mode
    - Capabilities: 3D touch
- Size classes
    - A layer of indirection - Size classes express experience (ex list view on iPhone, grid view on iPad)
    - Base your layout on available space and not the device, orientation, or adaptation.
    - Width class is most common size class that you will interact with - think primarily horizontally
- How traits work
    - `traitCollectionDidChange` sequence: Screen > Window > View Controller > View
    - Interface builder, Asset catalog, and UIAppearance work with `traitCollectionDidChange`
    - "Vary for Traits" button in IB to make changes across multiple devices. Helpful for adding a view to specific size classes.

## Whats New in Xcode App Signing

- Fundamentals
    - codesign tool behind the scenes
        - applies a code *seal* to your app - know if anyone tampered with the app after the fact
        - applies a code signature - know where the app came from
    - Certificates (Identity)
        - Issued by Apple
        - Development and Distribution
        - Require a private key (Apple never has a copy of this)
    - Provisioning Profiles (App-specific security information)
        - List of approved identifiers
        - Access to entitlements (support for capabilities)
- Signing Certificate per Mac
    - Multiple Development certs (Development only)
    - Usable with all versions in Xcode
- Signing in Xcode
    - New workflows and UI
    - Actionable messaging
    - Status reporting
    - Automatic Signing
        - Can see messaging in debug log tab
        - Development signing
        - Limited to xcode-created provisioning profiles
        - Distribution signing assets are untouched 
    - Customized Signing
        - Can select individual profiles per build configuration
        - New error reporting in the general tab
        - Profile info button popup with more info
        - Manually created profiles only (xcode will never modify them)
        - Any type of profile
        - Provisioning profile specifier - reference profiles by name
- Best Practices
    - Use Automatic
    - Add all developers to team
    - Use the capabilities tab
    - Don't set CODE_SIGN_IDENTITY
    - Use the new general tab UI
    - Distribution
        - Use development signing - Xcode will resign later when uploading to app store
